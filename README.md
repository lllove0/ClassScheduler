# ClassScheduler

# 舞蹈室约课系统 - 产品功能设计

## 一、核心设计理念

**可扩展 · 灵活配置 · 考勤为主**

- 支持多门店、多教室动态扩展
- 会员类型、课程类型可自定义
- 重点突出考勤统计功能

---

## 二、系统架构

### 三端设计
1. **学员端**（微信小程序）- 约课、查看课表
2. **教练端**（微信小程序）- 签到、查看课表
3. **管理端**（Web后台）- 配置、排课、统计

---

## 三、功能模块详细设计

### 📱 学员端（小程序）

#### 1. 首页
- **门店选择器**（顶部切换）
  - 显示所有门店列表
  - 切换后显示该门店的课程

- **课程日历/列表**
  - 按日期展示课程
  - 显示：课程名称、时间、教练、教室、剩余名额
  - 标识：已约、已满、可约

- **快捷筛选**
  - 按门店筛选
  - 按课程类型筛选（成人/儿童）
  - 按时间段筛选

#### 2. 课程详情
- 课程基本信息
  - 课程名称、教练、时间、教室
  - 课程介绍、适合人群
  - 当前预约人数/上限

- **预约操作**
  - 预约按钮（显示剩余次数/到期时间）
  - **取消预约**
    - 时间限制：开课前30分钟可取消
    - 超过时间显示"已超过取消时限"
    - 取消后自动恢复次数
  - 已约学员名单（可见/隐藏）

#### 3. 我的
- **会员信息卡片**
  - 会员类型（显示标签：成人月卡、儿童次卡等）
  - 剩余次数/有效期
  - 会员等级（如有）

- **我的课程**
  - 待上课（按时间排序）
    - 显示倒计时
    - **可取消预约**（开课前30分钟）
    - 超时显示"即将开始"或"进行中"
  - 历史记录（含考勤状态）
  - 缺课记录

- **考勤记录**
  - 按月份查看
  - 显示：出勤、缺勤、请假
  - 出勤率统计

- **个人设置**
  - 绑定手机号
  - 儿童档案管理（家长可添加多个孩子）
  - 消息通知设置

---

### 👨‍🏫 教练端（小程序）

#### 1. 今日课程
- 显示当天所有课程
- 每节课显示：时间、教室、预约人数

#### 2. 课程详情与签到
- **学员名单**
  - 显示已预约学员
  - 每个学员旁边有签到按钮
  - 批量签到功能

- **签到方式**
  - 手动点击签到
  - 扫码签到（学员出示二维码）

- **状态标记**
  - 已签到 ✓
  - 缺勤（未签到）
  - 请假

#### 3. 课程操作 ⭐新增

##### 3.1 取消课程
- **入口：** 课程详情页底部"取消本课"按钮
- **填写原因：**
  - 快捷选项：身体不适、临时有事、其他
  - 补充说明（选填）
- **确认取消：**
  - 显示已预约学员人数
  - 提示"将自动通知所有学员"
  - 二次确认弹窗

##### 3.2 调课申请
- 申请修改时间/教室
- 填写调整原因
- 提交给管理员审核

#### 4. 课表查看
- 本周/本月课表
- 筛选：按门店、按教室
- 显示课程状态（正常/已取消/已调整）

#### 5. 学员管理
- 查看学员档案
- 查看学员上课记录

---

### 💻 管理端（Web后台）

#### 1. 系统配置

##### 1.1 门店管理
- **门店列表**
  - 门店名称、地址、联系电话
  - 营业时间
  - 状态：营业中/装修中/已关闭

- **操作**
  - 新增门店
  - 编辑门店信息
  - 停用/启用门店

##### 1.2 教室管理
- **教室列表**（按门店分组）
  - 教室名称（如：1号舞蹈室、VIP教室）
  - 所属门店
  - 容纳人数
  - 设施说明

- **操作**
  - 新增教室
  - 编辑教室
  - 删除教室

##### 1.3 课程类型配置
- **课程分类**
  - 成人课程：爵士舞、拉丁舞、街舞等
  - 儿童课程：少儿芭蕾、少儿街舞等
  - 私教课

- **课程基础信息模板**
  - 课程名称
  - 适合年龄段
  - 课程时长（默认）
  - 课程介绍
  - 默认人数上限

##### 1.4 会员类型配置 ⭐重要
- **会员卡类型**（可自定义无限种）
  - 卡名称：如"成人月卡"、"儿童20次卡"
  - 适用人群：成人/儿童/通用
  - 计费方式：
    - 按次数（如20次）
    - 按时间（如30天不限次）
    - 按时间+次数（如30天内10次）
  - 有效期：天数
  - 适用门店：全部门店/指定门店
  - 适用课程：全部课程/指定课程类型
  - 价格（用于后期销售统计）

- **操作**
  - 新增会员类型
  - 编辑会员类型
  - 停用会员类型（已售出的不受影响）

##### 1.5 教练管理
- 教练姓名、手机号
- 擅长课程
- 所属门店（可多个）
- 授课时间偏好

##### 1.6 系统参数配置 ⭐新增
- **取消预约时限**：开课前X分钟（默认30分钟）
  - 可全局设置
  - 可按课程类型单独设置
- **预约提前时间**：最早可提前X天预约（默认7天）
- **消息通知时间**：开课前X分钟提醒（默认60分钟）

#### 2. 排课管理 ⭐核心功能

##### 2.1 智能排课日历
- **日历视图**
  - 按周/月显示
  - 多门店、多教室同时查看
  - 可拖拽调整课程时间

- **快速排课**
  - 选择门店
  - 选择教室
  - 选择课程类型
  - 选择教练
  - 设置时间（开始时间、时长）
  - 设置人数上限
  - 设置是否允许预约

- **循环排课**（批量创建）
  - 设置重复规则：每周一三五、仅周末等
  - 设置重复周期：4周、8周、长期
  - 批量生成课程

##### 2.2 课程管理
- 课程列表（可筛选：门店、教室、教练、日期、状态）
- 课程状态标识：
  - 🟢 正常
  - 🔴 已取消
  - 🟡 已调整
- 操作：
  - 编辑课程
  - **取消课程**
    - 管理员可直接取消
    - 填写取消原因
    - 系统自动通知已预约学员
    - 自动退还学员次数/标记可重约
  - **审核教练取消/调课申请**
    - 显示教练提交的申请列表
    - 查看申请原因
    - 同意/驳回
  - 调整时间（通知学员）
  - 调整教练

#### 3. 学员管理

##### 3.1 学员列表
- 显示：姓名、手机、会员类型、剩余次数、到期时间
- 筛选：按门店、按会员类型、按状态（正常/即将到期/已过期）
- 搜索：姓名、手机号

##### 3.2 学员详情
- **基本信息**
  - 姓名、性别、年龄、手机
  - 学员类型：成人/儿童
  - 家长信息（儿童必填）
  - 注册时间

- **会员卡信息**
  - 当前会员类型
  - 剩余次数/到期时间
  - 历史购卡记录

- **上课记录**
  - 已上课程列表
  - 出勤率统计

##### 3.3 开卡/续卡
- 选择学员
- 选择会员类型
- 设置生效时间
- 记录金额（可选）

#### 4. 考勤统计 ⭐核心功能

##### 4.1 实时考勤看板
- **今日课程考勤**
  - 显示所有课程的签到情况
  - 应到/实到/缺勤人数
  - 签到率

##### 4.2 考勤报表
- **按时间维度**
  - 日报表
  - 周报表
  - 月报表

- **按维度统计**
  - 按门店统计
  - 按教室统计
  - 按课程类型统计
  - 按教练统计

- **数据指标**
  - 总课时数
  - 总预约人次
  - 实际出勤人次
  - 平均出勤率
  - 满课率（实到/上限）

##### 4.3 学员考勤明细
- 选择学员，查看其考勤记录
- 显示：日期、课程、教练、状态
- **统计频繁取消学员**（标记"爽约"行为）
  - 显示取消次数和频率
  - 标记异常行为（如连续取消、临时取消等）
- 导出功能

##### 4.4 异常考勤提醒
- 连续缺勤提醒（如连续3次未到）
- 预约未到提醒
- 会员即将到期提醒

#### 5. 数据统计

##### 5.1 运营数据
- 学员总数、新增学员
- 在籍学员（会员未过期）
- 活跃学员（近30天上过课）
- 课程数量、开课率

##### 5.2 营收数据（可选）
- 售卡金额统计
- 按会员类型统计
- 按门店统计

##### 5.3 课程数据
- 热门课程排行（按预约数）
- 热门教练排行
- 热门时间段分析

#### 6. 消息通知

##### 6.1 自动通知（微信服务号消息）
- 预约成功通知
- 上课提醒（开课前1小时/2小时）
- **课程取消通知** ⭐新增
  - 通知内容：课程名称、原定时间、取消原因
  - 提示：已退还次数，可重新预约其他课程
- **课程调整通知** ⭐新增
  - 通知内容：原时间→新时间，调整原因
  - 提示：预约仍有效，如不能参加请取消预约
- 会员到期提醒（提前7天）

##### 6.2 手动群发
- 选择发送对象（全部/指定门店/指定会员类型）
- 编辑消息内容
- 发送通知

---

## 四、功能优先级

### P0（MVP必做）
- ✅ 门店、教室、会员类型配置
- ✅ 排课功能（手动排课）
- ✅ 学员预约课程
- ✅ 教练签到功能
- ✅ 基础考勤统计
- ✅ **教练取消课程（申请制）** ⭐新增

### P1（第二期）
- ⭐ 循环排课
- ⭐ 考勤报表详细统计
- ⭐ 消息通知（上课提醒、取消通知）
- ⭐ 学员开卡/续卡管理
- ⭐ 管理员审核取消申请

### P2（第三期，可选）
- 会员到期提醒
- 营收统计
- 请假功能
- 课程评价
- 学员积分

---

## 五、数据库设计要点

### 核心表
1. **门店表** (stores)
2. **教室表** (rooms) - 关联门店
3. **会员类型表** (member_types) - 可自定义
4. **学员表** (students)
5. **学员会员卡表** (student_cards) - 学员可有多张卡
6. **课程类型表** (course_types)
7. **课程表** (courses) - 具体排课记录
8. **预约表** (bookings)
9. **考勤表** (attendances)
10. **教练表** (teachers)
11. **课程取消记录表** (course_cancellations) ⭐新增
    - 取消时间、取消原因、操作人（教练/管理员）
    - 审核状态（待审核/已同意/已驳回）
    - 关联的课程ID

---

## 六、关键业务逻辑

### 1. 预约规则
- 检查会员卡是否有效（未过期）
- 检查剩余次数（次卡）
- 检查课程是否已满
- 检查是否重复预约
- 预约成功后扣除次数（或标记已用）

### 2. 签到逻辑
- 只有已预约的学员才能签到
- 签到后记录考勤表
- 未签到的自动标记为缺勤

### 3. 取消预约
- **时间限制：开课前30分钟可取消**（时限可在后台配置）
- 超过时限不可取消
- 取消后自动恢复次数
- 如已签到不可取消
- 记录取消时间和次数（用于统计分析）

### 4. 课程取消逻辑 ⭐新增
**教练发起取消：**
- 教练在小程序申请取消→管理员审核→通知学员

**管理员取消：**
- 管理后台直接取消→自动通知学员

**取消后处理：**
- 所有预约自动取消
- 自动退还学员次数（次卡）
- 时间卡标记为"未消耗"，可重新预约
- 发送微信通知给所有已预约学员
- 课程状态标记为"已取消"
- 记录取消原因和操作人

**是否允许教练直接取消（可配置）：**
- 方案A：教练只能申请，需管理员审核（推荐，更规范）
- 方案B：教练可直接取消（更灵活，但需事后追踪）

### 5. 会员卡计次逻辑
- 按次卡：预约时扣次，取消恢复
- 按时间卡：只检查有效期
- 混合卡：检查有效期+剩余次数

---

## 七、页面原型结构

### 学员端小程序页面
```
首页
 ├─ 门店切换
 ├─ 课程列表（按日期）
 └─ 筛选器

课程详情
 ├─ 课程信息
 ├─ 预约按钮
 └─ 已约名单

我的
 ├─ 会员卡片
 ├─ 我的课程
 ├─ 考勤记录
 └─ 设置
```

### 管理后台页面
```
系统配置
 ├─ 门店管理
 ├─ 教室管理
 ├─ 会员类型配置
 └─ 教练管理

排课中心
 ├─ 排课日历
 └─ 课程列表

学员管理
 ├─ 学员列表
 └─ 开卡/续卡

考勤统计
 ├─ 实时考勤
 ├─ 考勤报表
 └─ 异常提醒

数据统计
 ├─ 运营数据
 └─ 课程数据
```

---

## 八、特色功能设计

### 1. 灵活的会员类型配置 ⭐
**解决痛点：** 不同门店、不同人群需要不同的会员卡类型

**设计方案：**
- 管理员可以无限制添加会员类型
- 每种类型可单独配置规则
- 示例：
  - "成人周末卡"：仅周末使用，30天内8次
  - "儿童寒假卡"：指定日期范围，不限次数
  - "全能年卡"：全年不限次，所有门店通用

### 2. 多维度考勤统计 ⭐
**解决痛点：** 需要了解不同维度的出勤情况

**设计方案：**
- 支持多种组合筛选
- 可导出Excel
- 数据可视化（图表）

### 3. 儿童账户管理
**解决痛点：** 家长需要管理多个孩子的课程

**设计方案：**
- 一个家长账号可添加多个儿童档案
- 预约时选择为哪个孩子预约
- 分别显示每个孩子的考勤记录

---

*这是一个完整的产品功能设计方案，覆盖了你的核心需求。我们可以基于这个方案进一步细化任何模块。*
